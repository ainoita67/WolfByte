<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <!-- SE CREA EL BASE PATH PARA USAR EN TODOS LOS SCRIPTS, ENLACES Y REDIRECCIONES-->

        <script>const BASE = window.location.origin + "/frontend";</script>
        <script>const API = window.location.origin + "/API";</script>
        <!--
        AÑADE:
            <script src="/ALEX/frontend/javascript/includes.js"></script>
            <script src="/ALEX/frontend/javascript/menu.js"></script>
        QUE GENERAN EL RESTO DE ENLACES DEL HEAD Y EL HEADER, NAV Y FOOTER
        -->
        <script>
            const script1 = document.createElement("script");
            script1.src = BASE + "/javascript/includes.js";
            script1.onload = () => {
                const script2 = document.createElement("script");
                script2.src = BASE + "/javascript/menu.js";
                script2.onload = () => {
                generarPagina("menu", "admin");
                };
                document.head.appendChild(script2);
            };
            document.head.appendChild(script1);
        </script>


        <title>Salón de Actos - IES Bajo Aragón</title>
    </head>
    <body>

        <div id="header"></div>

        <main>
            <script src="../../../assets/daypilot/daypilot-all.min.js"></script>
            <link type="text/css" rel="stylesheet" href="../../../assets/css/calendar_green.css" />  
            
            <div class="container my-5">
                <div id="dp"></div>
            </div>

            <!-- Modal editar reserva -->
<div class="modal fade" id="modalEditarReserva" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-pencil-square me-2"></i>Editar Reserva</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="formEditarReserva" class="px-3">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12 col-md-6 mb-3">
                            <label class="form-label" for="asignatura">Asignatura</label>
                            <input type="text" class="form-control" id="asignatura" disabled>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label class="form-label" for="grupo">Grupo</label>
                            <input type="text" class="form-control" id="grupo" disabled>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label class="form-label" for="profesor">Profesor</label>
                            <input type="text" class="form-control" id="profesor" disabled>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label class="form-label" for="actividad">Actividad</label>
                            <input type="text" class="form-control" id="actividad" disabled>
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label class="form-label" for="start">Inicio</label>
                            <input type="datetime-local" class="form-control" id="start">
                        </div>
                        <div class="col-12 col-md-6 mb-3">
                            <label class="form-label" for="end">Fin</label>
                            <input type="datetime-local" class="form-control" id="end">
                        </div>
                    </div>
                </div>
                <div class="modal-footer d-flex justify-content-between">
                    <button type="submit" class="col-3 btn bg-azul border rounded-pill text-light"><i class="bi bi-check2"></i> Guardar</button>
                    <button type="button" class="col-3 btn bg-danger border rounded-pill text-light" id="btnEliminarReserva"><i class="bi bi-trash"></i> Eliminar</button>
                    <button type="button" class="col-3 btn bg-lightgrey border rounded-pill text-dark" data-bs-dismiss="modal"><i class="bi bi-x-lg"></i> Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>

 


            
<script type="module">
import { generarEventos } from "/frontend/javascript/reservas/crud.js";
// cojer id de la url
const params = new URLSearchParams(window.location.search);
const idAula = params.get("id");

document.addEventListener("DOMContentLoaded", async () => {
    const dp = new DayPilot.Calendar("dp", {
        viewType: "WorkWeek",
        theme: "calendar_green",
        startDate: DayPilot.Date.today(),

        locale: "es-es",            // formato europeo
        headerDateFormat: "dd/MM/yyyy",
        weekStarts: 1,

        cellDuration: 5,
        cellHeight: 8, 
        businessBeginsHour: 8,
        businessEndsHour: 22,
        eventDeleteHandling: "Disabled",
        heightSpec: "BusinessHoursNoScroll"

    });

    const eventos = await generarEventos(idAula);

    dp.events.list = eventos;
    dp.init();
    dp.onEventClick = function(args) {

    if (args.e.data.bloqueBase) {
        abrirModalCrear(args.e.data.start, args.e.data.end);
    } else {
        abrirModalEditar(args.e.data);
    }

};


    // BOTONES SEMANA ANTERIOR Y SIGUIENTE
    document.getElementById("prevWeek").addEventListener("click", () => {
        dp.startDate = dp.startDate.addDays(-7);
        dp.update();
    });

    document.getElementById("nextWeek").addEventListener("click", () => {
        dp.startDate = dp.startDate.addDays(7);
        dp.update();
    });


});

document.getElementById("btnVolver").addEventListener("click", () => {
    window.location.href = `${BASE}/vistas/reservas/aulas/aulas.html`;
});

function abrirModalEditar(evento) {

    document.getElementById("asignatura").value = evento.asignatura;
    document.getElementById("grupo").value = evento.grupo;
    document.getElementById("profesor").value = evento.profesor;
    document.getElementById("actividad").value = evento.actividad;

    document.getElementById("start").value = evento.start.substring(0,16);
    document.getElementById("end").value = evento.end.substring(0,16);

    const modal = new bootstrap.Modal(document.getElementById("modalEditarReserva"));
    modal.show();
}

function abrirModalCrear(start, end) {

    document.getElementById("asignatura").value = "";
    document.getElementById("grupo").value = "";
    document.getElementById("profesor").value = "";
    document.getElementById("actividad").value = "";

    document.getElementById("start").value = start.substring(0,16);
    document.getElementById("end").value = end.substring(0,16);

    const modal = new bootstrap.Modal(document.getElementById("modalEditarReserva"));
    modal.show();
}


</script>



        </main>
        <footer id="footer"></footer>
    </body>
</html>