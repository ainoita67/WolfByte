<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Aulas y espacios - IES Bajo Arag√≥n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <script>const BASE = window.location.origin + "/frontend";</script>
    <script>
        const script1 = document.createElement("script");
        script1.src = BASE + "/javascript/includes.js";
        script1.onload = () => {
            const script2 = document.createElement("script");
            script2.src = BASE + "/javascript/menu.js";
            script2.onload = () => {
                generarPagina("admin", "admin");
            };
            document.head.appendChild(script2);
        };
        document.head.appendChild(script1);
    </script>
</head>
<body>
<div id="header"></div>
<main class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Gesti√≥n de Aulas y Espacios</h2>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalCrear">
            <i class="bi bi-plus-circle"></i> Aulas/Espacios
        </button>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle text-center tabla-cabecera">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th class="d-none d-md-table-cell">Tipo</th>
                    <th class="d-none d-md-table-cell">Edificio</th>
                    <th class="d-none d-md-table-cell">Piso</th>
                    <th>Estado</th>
                    <th class="d-none d-md-table-cell">Autorizaci√≥n</th>
                    <th class="d-none d-md-table-cell">Caracter√≠sticas</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tablaEspacios">
                <tr>
                    <td>A-01</td>
                    <td>Aula 101</td>
                    <td class="d-none d-md-table-cell">Aula</td>
                    <td class="d-none d-md-table-cell">A</td>
                    <td class="d-none d-md-table-cell">1</td>
                    <td>Disponible</td>
                    <td class="d-none d-md-table-cell">S√≠</td>
                    <td class="d-none d-md-table-cell">Pizarra, Proyector</td>
                    <td>
                        <button class="btn btn-primary btn-sm btn-mostrar d-md-none">
                            <i class="bi bi-eye"></i>
                        </button>
                        <div class="d-none d-md-inline">
                            <button class="btn btn-warning btn-sm btn-editar" data-bs-toggle="modal" data-bs-target="#modalEditar">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-danger btn-sm">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="divvolver container p-0 pb-3 mt-0 mb-5 pe-4 pe-md-0 text-end fs-5">
        <a href="../menuadministrador.html" class="bg-azul rounded-pill p-2 px-3 ms-5 text-light"><i class="bi bi-caret-left-fill"></i> Volver</a>
    </div>
</main>

<!-- MODAL CREAR -->
<div class="modal fade" id="modalCrear" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Crear aula / espacio</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formCrearEspacio">
                    <div class="row mb-3">
                        <div class="col"><input class="form-control" name="id" placeholder="ID" required></div>
                        <div class="col"><input class="form-control" name="nombre" placeholder="Nombre" required></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <label class="fw-bold d-block">Tipo</label>
                            <input type="radio" name="tipo" value="Aula" checked> Aula
                            <input type="radio" name="tipo" value="Espacio" class="ms-3"> Espacio
                        </div>
                        <div class="col">
                            <label class="fw-bold d-block">Estado</label>
                            <input type="radio" name="estado" value="Disponible" checked> Disponible
                            <input type="radio" name="estado" value="Inactiva" class="ms-3"> Inactiva
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <label class="fw-bold d-block">Edificio</label>
                            <select class="form-select" name="edificio" required>
                                <option value="">Seleccionar</option>
                                <option>A</option><option>B</option><option>C</option>
                            </select>
                        </div>
                        <div class="col">
                            <label class="fw-bold d-block">Piso</label>
                            <select class="form-select" name="piso" required>
                                <option value="">Seleccionar</option>
                                <option>1</option><option>2</option><option>3</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 form-check">
                        <input class="form-check-input" type="checkbox" id="autorizacionCrear">
                        <label class="form-check-label">Necesita autorizaci√≥n</label>
                    </div>
                    <div class="mb-3">
                        <label class="fw-bold">Caracter√≠sticas</label>
                        <select class="form-select" id="caracteristicasCrear" multiple>
                            <option>Pizarra</option><option>Proyector</option><option>Ordenador</option>
                            <option>Aire acondicionado</option><option>Accesible</option><option>Inform√°tica</option>
                        </select>
                        <small class="text-muted">Ctrl / Cmd para seleccionar varias</small>
                    </div>
                    <button class="btn btn-success w-100">Guardar</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- MODAL EDITAR -->
<div class="modal fade" id="modalEditar" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Editar aula / espacio</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formEditarEspacio">
                    <div class="row mb-3">
                        <div class="col"><input class="form-control" id="editId" readonly></div>
                        <div class="col"><input class="form-control" id="editNombre"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <label class="fw-bold d-block">Tipo</label>
                            <input type="radio" name="editTipo" value="Aula"> Aula
                            <input type="radio" name="editTipo" value="Espacio" class="ms-3"> Espacio
                        </div>
                        <div class="col">
                            <label class="fw-bold d-block">Estado</label>
                            <input type="radio" name="editEstado" value="Disponible"> Disponible
                            <input type="radio" name="editEstado" value="Inactiva" class="ms-3"> Inactiva
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <label class="fw-bold d-block">Edificio</label>
                            <select class="form-select" id="editEdificio">
                                <option value="">Seleccionar</option>
                                <option>A</option><option>B</option><option>C</option>
                            </select>
                        </div>
                        <div class="col">
                            <label class="fw-bold d-block">Piso</label>
                            <select class="form-select" id="editPiso">
                                <option value="">Seleccionar</option>
                                <option>1</option><option>2</option><option>3</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 form-check">
                        <input class="form-check-input" type="checkbox" id="editAutorizacion">
                        <label class="form-check-label">Necesita autorizaci√≥n</label>
                    </div>
                    <div class="mb-3">
                        <label class="fw-bold">Caracter√≠sticas</label>
                        <select class="form-select" id="caracteristicasEditar" multiple>
                            <option>Pizarra</option><option>Proyector</option><option>Ordenador</option>
                            <option>Aire acondicionado</option><option>Accesible</option><option>Inform√°tica</option>
                        </select>
                    </div>
                    <button class="btn btn-primary w-100">Guardar cambios</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- MODAL MOSTRAR -->
<div class="modal fade" id="modalMostrar" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Detalle del aula / espacio</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="contenidoMostrar"></div>
            <div class="modal-footer" id="footerMostrar"></div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const tabla = document.getElementById("tablaEspacios");

// ACTIVAR BOTONES
function activarBotones() {
    document.querySelectorAll(".btn-editar").forEach(btn => {
        btn.onclick = function() {
            const fila = this.closest("tr");
            document.getElementById("editId").value = fila.children[0].textContent;
            document.getElementById("editNombre").value = fila.children[1].textContent;
            const tipo = fila.children[2].textContent;
            document.querySelectorAll('input[name="editTipo"]').forEach(r => r.checked = (r.value === tipo));
            document.getElementById("editEdificio").value = fila.children[3].textContent;
            document.getElementById("editPiso").value = fila.children[4].textContent;
            const estado = fila.children[5].textContent;
            document.querySelectorAll('input[name="editEstado"]').forEach(r => r.checked = (r.value === estado));
            document.getElementById("editAutorizacion").checked = fila.children[6].textContent === "S√≠";
            const caracts = fila.children[7].textContent.split(", ").filter(c => c);
            const select = document.getElementById("caracteristicasEditar");
            for (let option of select.options) option.selected = caracts.includes(option.value);
            document.getElementById("formEditarEspacio").dataset.fila = Array.from(tabla.rows).indexOf(fila);
        };
    });

    document.querySelectorAll(".btn-borrar").forEach(btn => {
        btn.onclick = function() { this.closest("tr").remove(); };
    });
}

// MODAL MOSTRAR FUNCIONAL
document.addEventListener("click", function(e) {
    if (e.target.closest(".btn-mostrar")) {
        const fila = e.target.closest("tr");
        document.getElementById("contenidoMostrar").innerHTML = `
            <p><strong>ID:</strong> ${fila.children[0].textContent}</p>
            <p><strong>Nombre:</strong> ${fila.children[1].textContent}</p>
            <p><strong>Tipo:</strong> ${fila.children[2].textContent}</p>
            <p><strong>Edificio:</strong> ${fila.children[3].textContent}</p>
            <p><strong>Piso:</strong> ${fila.children[4].textContent}</p>
            <p><strong>Estado:</strong> ${fila.children[5].textContent}</p>
            <p><strong>Autorizaci√≥n:</strong> ${fila.children[6].textContent}</p>
            <p><strong>Caracter√≠sticas:</strong> ${fila.children[7].textContent}</p>
        `;
        const footer = document.getElementById("footerMostrar");
        footer.innerHTML = `
            <button class="btn btn-warning btn-sm" id="editarDesdeMostrar" data-bs-dismiss="modal">Editar</button>
            <button class="btn btn-danger btn-sm" id="borrarDesdeMostrar" data-bs-dismiss="modal">Borrar</button>
        `;
        document.getElementById("editarDesdeMostrar").onclick = () => fila.querySelector(".btn-editar").click();
        document.getElementById("borrarDesdeMostrar").onclick = () => fila.remove();
        new bootstrap.Modal(document.getElementById("modalMostrar")).show();
    }
});


// CREAR
document.getElementById("formCrearEspacio").addEventListener("submit", function(e) {
    e.preventDefault();
    const id = this.id.value, nombre = this.nombre.value;
    const tipo = document.querySelector('input[name="tipo"]:checked').value;
    const edificio = this.edificio.value, piso = this.piso.value;
    const estado = document.querySelector('input[name="estado"]:checked').value;
    const autorizacion = document.getElementById("autorizacionCrear").checked ? "S√≠" : "No";
    const caracts = [...document.getElementById("caracteristicasCrear").selectedOptions].map(o => o.value);
    const fila = document.createElement("tr");
    fila.innerHTML = `
        <td>${id}</td><td>${nombre}</td>
        <td class="d-none d-md-table-cell">${tipo}</td>
        <td class="d-none d-md-table-cell">${edificio}</td>
        <td class="d-none d-md-table-cell">${piso}</td>
        <td>${estado}</td>
        <td class="d-none d-md-table-cell">${autorizacion}</td>
        <td class="d-none d-md-table-cell">${caracts.join(", ")}</td>
        <td>
            <button class="btn btn-primary btn-sm btn-mostrar d-md-none"><i class="bi bi-eye"></i></button>
            <button class="btn btn-warning btn-sm btn-editar" data-bs-toggle="modal" data-bs-target="#modalEditar">‚úèÔ∏è</button>
            <button class="btn btn-danger btn-sm btn-borrar">üóëÔ∏è</button>
        </td>`;
    tabla.appendChild(fila);
    this.reset();
    bootstrap.Modal.getInstance(document.getElementById("modalCrear")).hide();
    activarBotones();
});

// EDITAR
document.getElementById("formEditarEspacio").addEventListener("submit", function(e) {
    e.preventDefault();
    const filaIndex = this.dataset.fila;
    const fila = tabla.rows[filaIndex];
    fila.children[1].textContent = document.getElementById("editNombre").value;
    fila.children[2].textContent = document.querySelector('input[name="editTipo"]:checked').value;
    fila.children[3].textContent = document.getElementById("editEdificio").value;
    fila.children[4].textContent = document.getElementById("editPiso").value;
    fila.children[5].textContent = document.querySelector('input[name="editEstado"]:checked').value;
    fila.children[6].textContent = document.getElementById("editAutorizacion").checked ? "S√≠" : "No";
    const caracts = [...document.getElementById("caracteristicasEditar").selectedOptions].map(o => o.value);
    fila.children[7].textContent = caracts.join(", ");
    bootstrap.Modal.getInstance(document.getElementById("modalEditar")).hide();
    activarBotones();
});

activarBotones();
</script>
</body>
</html>
